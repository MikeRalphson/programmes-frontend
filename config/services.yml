parameters:
    guzzle.factory.group: 'aws'
    app.default_locale: 'en_GB'
    app.orbit_client.class: RMP\OrbClient\OrbitClient
    app.branding_client.class: BBC\BrandingClient\BrandingClient

services:

    _defaults:
        autowire: true
        public: false

    _instanceof:
        Symfony\Component\Console\Command\Command:
            tags: ['console.command']
            public: true  # Mandatory

        Twig_ExtensionInterface:
            tags: ['twig.extension']

        Symfony\Component\EventDispatcher\EventSubscriberInterface:
            tags: ['kernel.event_subscriber']

        Symfony\Component\Form\FormTypeInterface:
            tags: ['form.type']

    App\:
        resource: '../src/{Command,EventSubscriber,Twig}'

    App\Controller\:
        resource: '../src/Controller'
        public: true # Mandatory


    ### Begin the services!

    RMP\GuzzleFactory\GuzzleFactory:
        calls:
            - ['setDefaultGroupName', ['%guzzle.factory.group%']]

    guzzle:
        class: GuzzleHttp\Client
        factory: ['@RMP\GuzzleFactory\GuzzleFactory', 'getClient']
        arguments:
          - ~
          - timeout: 60
            connect_timeout: 15
            verify: false #TODO fix me

    # TODO: Work out how to pass through a SymfonyCache object wrapped in a
    # DoctrineProvider. So that we can see caching information in the profiler
    # panel that shall land in Symfony 3.3
    app.orbit_client:
        public: true
        class: '%app.orbit_client.class%'
        arguments: ['@guzzle', '@doctrine_cache.providers.app_page_chrome']

    # TODO: Work out how to pass through a SymfonyCache object wrapped in a
    # DoctrineProvider. So that we can see caching information in the profiler
    # panel that shall land in Symfony 3.3
    app.branding_client:
        public: true
        class: '%app.branding_client.class%'
        arguments: ['@guzzle', '@doctrine_cache.providers.app_page_chrome']


    ### Translations

    RMP\Translate\TranslateFactory: ~

    app.translate_en:
        autowire: false
        class: RMP\Translate\Translate
        factory: ['@RMP\Translate\TranslateFactory', 'create']
        arguments: ['%app.default_locale%']


    ### Monitoring

    App\EventSubscriber\MonitoringSubscriber:
        tags:
            - { name: 'kernel.event_subscriber' }
            - { name: 'monolog.logger', channel: 'app_access' }


    ### Programmes Service
    # TODO see if repating every service here can be replaced with prototype
    # services in Symfony 3.3: https://github.com/symfony/symfony/pull/21289
    BBC\ProgrammesPagesService\Service\ServiceFactory: ~

    pps.programmes_service:
        public: true
        autowire: false
        class: BBC\ProgrammesPagesService\Service\ProgrammesService
        factory: [ '@BBC\ProgrammesPagesService\Service\ServiceFactory', 'getProgrammesService']
